Attack Type
========================================

Gold notes utilization
----------------------------------------
During the authentication process, TGT will be obtained through communication between the client and the AS. Golden Ticket is a forged bill granting bill (TGT), also known as a certified bill.

Gold notes use need to communicate with DC and need to obtain the hash of krbtgt, but can obtain any Kerbose service permissions.

Silver bill utilization
----------------------------------------
Silver Tickets forged the use of the third step in Kerberos authentication. In the third step, the client will take the ticket to a server service. If the verification is passed, you can access the specified on the server. It is served, and the ticket here is based on client info, server session key, end time, and server hash. Here, client info is known, end time can be constructed, and server session key is generated by TGS, so only server's NTLM hash is enough. The banknote forged TGS and can only access specified services.

DCSync Attack
----------------------------------------
When there are multiple domain control servers in the domain, in order to synchronize the modification of the domain control server, Microsoft provides a remote directory protocol based on `DRSR <https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-drsr/f977faaa -673e-4f66-b9bf-48c640241d47>`_ synchronization mechanism.

Between multiple domain control servers, the domain data will be synchronized every once in a while. The domain control server that needs to be synchronized sends a GetNCChanges request to other servers, and the request contains the data that needs to be synchronized. When there is a large amount of data, repeat this process.

DCSync is a technology that uses this mechanism for domain penetration. It was written by Benjamin DELPY gentilkiwi and Vincent LE TOUX. It was added to mimikatz in 2015 to export hash of all users in the domain.

This method requires any of the following permissions:

- Users in Administrators Group
- Domain Admins users in group
- Users in Enterprise Admins Group
- Domain Controller Computer Account

Or have a few specific DACLs:

- DS-Replication-Get-Changes
- DS-Replication-Get-Changes-All
- DS-Replication-Get-Changes-In-Filtered-Set

When there is no administrator user but have WriteDACL permissions, you can write the above DACL to complete DCSync.

For this kind of attack, it can be considered a DCSync attack by detecting the initiator of GetNCChanges.

DCShadow Attack
----------------------------------------
DCShadow was proposed by security researchers Benjamin Delpy and Vincent Le Toux from France at the 2018 Microsoft Blue Hat Conference.

DCShadow attack refers to creating a malicious domain controller in an Active Directory environment and using it to push malicious objects.

Hash delivery attack
----------------------------------------
Hash pass-through attack (PTH) is an attack method authenticated by passing NTLM hash. Commonly used tools include mimikatz, etc.

Ticket delivery attack
----------------------------------------
Pass-the-Ticket Attacks (PtT) is a method that uses Kerberos tickets instead of plaintext passwords or NTLM hashing. The most common use of PtT is probably the use of gold and silver notes, and accessing the host through PtT is quite simple.

Kerberoasting Attacks
----------------------------------------
Kerberoasting Attacks by Tim Medin on 2014 DerbyCon conference `opened <https://www.youtube.com/watch?v=PUyhlN-E5MU>`_ . It means that any host in the domain can query the SPN. Kerberoasting requests TGS from all services in the domain and then performs brute-force cracking.

Roasting AS-REP
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The attack enumeration account in the domain that does not require Kerberos pre-authentication, requests an encrypted information from these accounts, and attempts to obtain the account hash offline. This method requires that the account clearly set ``DONT_REQ_PREAUTH``.

Kerberos Delegation Attacks
----------------------------------------
In a domain, A uses Kerberos authentication to access service B, and then B uses A's identity to access C, and this process can be understood as delegation. Delegation is mainly divided into two types: Unconstrained delegation and Constrained delegation. Nonconstrained delegation can access any other services in the domain. Constrained delegation restricts authentication and cannot access other services.

Kerberos Delegation (Kerberos delegation) attacks are divided into non-constrained delegation attacks and constrained delegation attacks. The principle is based on the domain that has been configured to obtain permissions to other accounts.

Other exploits
----------------------------------------
- Domain user rights promotion (CVE-2022-26923)
- KDC bamboozling (CVE-2021-42287)
- Name impersonation (CVE-2021-42278)
- ProxyShell (CVE-2021-34473)
- ProxyLogon (CVE-2021-26855)
- PrintNightmare (CVE-2021-1675 / CVE-2021-34527)
- SMBGhost (CVE-2020-0796)
- Zerologon (CVE-2020-1472)
- NTLM Relay (CVE-2019-1040)
- Eternal Blue (MS17-010)
- Domain user rights promotion (MS14-068)
- Gpp Vulnerability (MS14-025)
- SAMR protocol vulnerability (MS14-016)
